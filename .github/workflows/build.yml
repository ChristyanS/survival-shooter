name: Build
on: 
  push:
    branches:
      - main
env:
  UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}
jobs:	

  build:
    name: Build my project ✨
    runs-on: ubuntu-latest
    steps:	
      - name: Checkout repository ☑️
        uses: actions/checkout@v2
        with:
          lfs: true
      - name: Active Cache
        uses: actions/cache@v1.1.0
        with:
          path: Library
          key: Library
           
                
      - name: Unity - Builder 🔨
        uses: game-ci/unity-builder@v2.0-aplha-5
        with:
          unityVersion: 2020.2.1f1
          targetPlatform: StandaloneWindows64
          kubeVolumeSize: 8Gi
      
      - name: Upload Build ⬆️
        uses: actions/upload-artifact@v1
        with:
          name: Build
          path: build
          
  release-project:
    name: Create Release 📦
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Download site ⬇️
        uses: actions/download-artifact@v2
        id: download
        with: 
          name: Build
          
      - name: Archive Build content
        uses: thedoctor0/zip-release@master
        with:
          filename: Build.zip
        
      - name: Create GitHub Release 🐱📦
        id: create-new-release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with: 
          tag_name: v${{github.run_number}}
          release_name: V${{github.run_number}}
          
      - name: Upload asset to Github Release
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          upload_url: ${{steps.create-new-release.outputs.upload_url}}
          asset_name: Build-v${{github.run_number}}.zip
          asset_path: ./Build.zip
          asset_content_type: application/zip
        
